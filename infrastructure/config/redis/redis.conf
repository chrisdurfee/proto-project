# Redis performance & security configuration
# Optimized for high concurrency and security

# PERSISTENCE - Append Only File for durability
appendonly yes
appendfsync everysec

# SECURITY: Disable dangerous commands in production
# Password is passed via container command using --requirepass
rename-command FLUSHALL ""
rename-command FLUSHDB ""
rename-command CONFIG ""
rename-command SHUTDOWN ""
rename-command DEBUG ""
rename-command KEYS ""
rename-command MIGRATE ""
rename-command SLAVEOF ""
rename-command REPLICAOF ""

# MEMORY MANAGEMENT - Scalability
# Set to ~70% of container memory allocation
maxmemory 700mb
maxmemory-policy allkeys-lru
maxmemory-samples 10

# NETWORKING & SECURITY
protected-mode yes
port 6379
bind 0.0.0.0
tcp-backlog 511
timeout 0
tcp-keepalive 300

# CLIENT CONNECTIONS - High Concurrency
maxclients 10000

# PERFORMANCE TUNING
# Lazy freeing for better responsiveness
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes

# Active defragmentation for long-running instances
activedefrag yes
active-defrag-ignore-bytes 100mb
active-defrag-threshold-lower 10
active-defrag-threshold-upper 50
active-defrag-cycle-min 1
active-defrag-cycle-max 25

# IO THREADS - Parallel processing for multi-core
io-threads 4
io-threads-do-reads yes

# Disable RDB snapshots (using AOF)
save ""

# LOGGING
loglevel notice
logfile ""
