# Event MPM Configuration for HTTP/2 Support - HIGH CONCURRENCY
# This MPM is required for HTTP/2 to work with mod_http2
# Optimized for handling many concurrent users

<IfModule mpm_event_module>
    # StartServers: initial number of server processes to start
    # Higher value for faster warm-up on container restart
    StartServers             4

    # ServerLimit: upper limit on configurable number of processes
    # Must be >= MaxRequestWorkers / ThreadsPerChild
    ServerLimit              16

    # MinSpareThreads: minimum number of worker threads which are kept spare
    MinSpareThreads          75

    # MaxSpareThreads: maximum number of worker threads which are kept spare
    MaxSpareThreads          250

    # ThreadLimit: upper limit on ThreadsPerChild (must be set before ThreadsPerChild)
    ThreadLimit              64

    # ThreadsPerChild: constant number of worker threads in each server process
    # Higher values = more concurrency per process, less process overhead
    ThreadsPerChild          64

    # MaxRequestWorkers: maximum number of simultaneous connections
    # Formula: ServerLimit * ThreadsPerChild
    # 16 * 64 = 1024 concurrent connections
    MaxRequestWorkers        1024

    # MaxConnectionsPerChild: maximum number of connections a server process serves
    # Set to non-zero to prevent memory leaks (0 = unlimited)
    MaxConnectionsPerChild   10000

    # AsyncRequestWorkerFactor: Determines concurrent connections per worker
    # Higher value allows more keep-alive connections per worker
    AsyncRequestWorkerFactor 2

    # ListenBacklog: Length of the pending connection queue
    ListenBacklog            511
</IfModule>

# Timeout settings for high concurrency
Timeout 300
KeepAlive On
MaxKeepAliveRequests 500
KeepAliveTimeout 5
